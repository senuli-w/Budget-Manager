<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="theme-color" content="#6366f1">
    <meta name="description" content="A simple and beautiful budget management app">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Budget">
    <title>Budget Manager</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect fill='%236366f1' width='192' height='192'/><path fill='white' d='M96 30c-36.33 0-66 29.67-66 66s29.67 66 66 66 66-29.67 66-66-29.67-66-66-66zm0 120c-29.82 0-54-24.18-54-54s24.18-54 54-54 54 24.18 54 54-24.18 54-54 54zm-6-84h12v36h-12z'/><path fill='white' d='M96 60c6.63 0 12-5.37 12-12s-5.37-12-12-12-12 5.37-12 12 5.37 12 12 12z'/></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect fill='%236366f1' width='192' height='192'/><path fill='white' d='M96 30c-36.33 0-66 29.67-66 66s29.67 66 66 66 66-29.67 66-66-29.67-66-66-66zm0 120c-29.82 0-54-24.18-54-54s24.18-54 54-54 54 24.18 54 54-24.18 54-54 54zm-6-84h12v36h-12z'/><path fill='white' d='M96 60c6.63 0 12-5.37 12-12s-5.37-12-12-12-12 5.37-12 12 5.37 12 12 12z'/></svg>">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="login-header">
                <div class="login-icon">
                    <i class="bi bi-wallet2"></i>
                </div>
                <h1>Budget Manager</h1>
                <p>Manage your finances with ease</p>
            </div>
            
            <form class="login-form" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="pinInput">PIN</label>
                    <input type="password" id="pinInput" class="form-input" minlength="4" maxlength="4" placeholder="Enter your 4-digit PIN" required autofocus>
                    <small class="form-hint">Use your personal PIN (1644) to unlock the app on every device.</small>
                </div>
                <button type="submit" class="btn-primary">Login</button>
            </form>
            
            <p class="login-footer">Your data is encrypted and synced securely</p>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="main-app" style="display: none;">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <h1>Budget Manager</h1>
                <button class="btn-icon btn-logout" onclick="handleLogout()">
                    <i class="bi bi-box-arrow-right"></i>
                </button>
            </div>
            <p id="currentDate" class="header-date"></p>
        </header>

        <!-- Navigation Tabs -->
        <nav class="app-nav">
            <button class="nav-tab active" data-section="dashboard" onclick="switchSection(event, 'dashboard')">
                <i class="bi bi-speedometer2"></i>
                <span>Overview</span>
            </button>
            <button class="nav-tab" data-section="add-transaction" onclick="switchSection(event, 'add-transaction')">
                <i class="bi bi-plus-circle"></i>
                <span>Add</span>
            </button>
            <button class="nav-tab" data-section="transactions" onclick="switchSection(event, 'transactions')">
                <i class="bi bi-list-ul"></i>
                <span>History</span>
            </button>
            <button class="nav-tab" data-section="accounts" onclick="switchSection(event, 'accounts')">
                <i class="bi bi-bank"></i>
                <span>Accounts</span>
            </button>
        </nav>

        <!-- Main Content -->
        <main class="app-content">
            <!-- Dashboard Section -->
            <section id="dashboard" class="section active">
                <div class="dashboard-grid">
                    <!-- Total Balance Card -->
                    <div class="stat-card balance">
                        <div class="stat-label">Total Balance</div>
                        <div class="stat-value" id="totalBalance">Rs. 0.00</div>
                        <div class="stat-icon">
                            <i class="bi bi-wallet2"></i>
                        </div>
                    </div>

                    <!-- This Month Income Card -->
                    <div class="stat-card income">
                        <div class="stat-label">This Month Income</div>
                        <div class="stat-value" id="monthIncome">Rs. 0.00</div>
                        <div class="stat-icon">
                            <i class="bi bi-graph-up"></i>
                        </div>
                    </div>

                    <!-- This Month Expenses Card -->
                    <div class="stat-card expense">
                        <div class="stat-label">This Month Expenses</div>
                        <div class="stat-value" id="monthExpenses">Rs. 0.00</div>
                        <div class="stat-icon">
                            <i class="bi bi-graph-down"></i>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="charts-grid">
                    <div class="chart-card">
                        <h3>Spending by Category</h3>
                        <canvas id="accountsChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Income vs Expenses</h3>
                        <canvas id="incomeExpenseChart"></canvas>
                    </div>
                </div>

                <!-- Accounts Summary -->
                <div class="section-card">
                    <h3>Your Accounts</h3>
                    <div id="dashboardAccounts" class="accounts-list">
                        <!-- Dynamically populated -->
                    </div>
                </div>

                <!-- Recent Transactions -->
                <div class="section-card">
                    <h3>Recent Transactions</h3>
                    <div id="dashboardTransactions" class="transactions-list">
                        <!-- Dynamically populated -->
                    </div>
                </div>
            </section>

            <!-- Add Transaction Section -->
            <section id="add-transaction" class="section">
                <form class="transaction-form" onsubmit="handleAddTransaction(event)">
                    <h2>Add Transaction</h2>

                    <div class="form-group">
                        <label>Type</label>
                        <div class="transaction-type-selector">
                            <label class="type-option">
                                <input type="radio" name="type" value="expense" checked>
                                <span>Expense</span>
                            </label>
                            <label class="type-option">
                                <input type="radio" name="type" value="income">
                                <span>Income</span>
                            </label>
                            <label class="type-option">
                                <input type="radio" name="type" value="transfer">
                                <span>Transfer</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="txnAmount">Amount</label>
                        <input type="number" id="txnAmount" class="form-input" placeholder="0.00" step="0.01" min="0" required>
                    </div>

                    <div class="form-group">
                        <label for="txnCategory">Category</label>
                        <select id="txnCategory" class="form-input" required>
                            <option value="">Select category</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="txnAccount">From Account</label>
                        <select id="txnAccount" class="form-input" required>
                            <option value="">Select account</option>
                        </select>
                    </div>

                    <div class="form-group" id="txnToAccountGroup" style="display: none;">
                        <label for="txnToAccount">To Account</label>
                        <select id="txnToAccount" class="form-input">
                            <option value="">Select account</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="txnDate">Date</label>
                        <input type="date" id="txnDate" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label for="txnNote">Note</label>
                        <input type="text" id="txnNote" class="form-input" placeholder="Optional note">
                    </div>

                    <button type="submit" class="btn-primary btn-large">Add Transaction</button>
                </form>
            </section>

            <!-- Transactions Section -->
            <section id="transactions" class="section">
                <div class="section-header">
                    <h2>Transaction History</h2>
                </div>

                <div class="filter-bar">
                    <select id="filterAccount" class="form-input">
                        <option value="">All Accounts</option>
                    </select>
                    <select id="filterType" class="form-input">
                        <option value="">All Types</option>
                        <option value="income">Income</option>
                        <option value="expense">Expense</option>
                        <option value="transfer">Transfer</option>
                    </select>
                </div>

                <div id="transactionsList" class="transactions-list">
                    <!-- Dynamically populated -->
                </div>
            </section>

            <!-- Accounts Section -->
            <section id="accounts" class="section">
                <div class="section-header">
                    <h2>Your Accounts</h2>
                    <button class="btn-icon" onclick="showAddAccountModal()">
                        <i class="bi bi-plus-lg"></i>
                    </button>
                </div>

                <div id="accountsList" class="accounts-list">
                    <!-- Dynamically populated -->
                </div>
            </section>
        </main>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="loading-indicator" style="display: none;">
            <div class="spinner"></div>
        </div>
    </div>

    <!-- Modals -->
    
    <!-- Add Account Modal -->
    <div id="addAccountModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Account</h2>
                <button class="btn-icon" onclick="closeModal('addAccountModal')">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <form class="modal-form" onsubmit="handleAddAccount(event)">
                <div class="form-group">
                    <label for="accountName">Account Name</label>
                    <input type="text" id="accountName" class="form-input" placeholder="e.g., BOC Savings" required>
                </div>
                <div class="form-group">
                    <label for="accountType">Account Type</label>
                    <select id="accountType" class="form-input" required>
                        <option value="">Select type</option>
                        <option value="savings">Savings</option>
                        <option value="checking">Checking</option>
                        <option value="cash">Cash</option>
                        <option value="credit">Credit Card</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="accountBalance">Initial Balance</label>
                    <input type="number" id="accountBalance" class="form-input" placeholder="0.00" step="0.01" value="0" required>
                </div>
                <button type="submit" class="btn-primary">Add Account</button>
            </form>
        </div>
    </div>

    <!-- Success Toast -->
    <div id="successToast" class="toast" style="display: none;">
        <div class="toast-content">
            <i class="bi bi-check-circle"></i>
            <span id="toastMessage"></span>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebaseapp/10.6.0/firebase-app-compat.min.js"></script>
    <script src="https://www.gstatic.com/firebaseapp/10.6.0/firebase-auth-compat.min.js"></script>
    <script src="https://www.gstatic.com/firebaseapp/10.6.0/firebase-firestore-compat.min.js"></script>

    <!-- App Scripts -->
    <script src="js/config.js"></script>
    <script src="js/db.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
